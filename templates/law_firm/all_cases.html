{% extends 'law_firm/base.html' %} {% load staticfiles %} {% load range_filter %} {% block theme_styles %}
<link href="{% static 'theme/bs3/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'theme/css/bootstrap-reset.css' %}" rel="stylesheet">
<link href="{% static 'theme/font-awesome/css/font-awesome.css' %}" rel="stylesheet" />

<link href="{% static 'theme/js/iCheck/skins/minimal/minimal.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/red.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/green.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/blue.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/yellow.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/purple.css' %}" rel="stylesheet">

<link href="{% static 'theme/js/iCheck/skins/square/square.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/red.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/green.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/blue.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/yellow.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/purple.css' %}" rel="stylesheet">

<link href="{% static 'theme/js/iCheck/skins/flat/grey.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/red.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/green.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/blue.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/yellow.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/purple.css' %}" rel="stylesheet">

<link rel="stylesheet" href="{% static 'theme/js/data-tables/DT_bootstrap.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'theme/js/jquery-tags-input/jquery.tagsinput.css' %}" />

<!-- Custom styles for this template -->
<link href="{% static 'theme/css/style.css' %}" rel="stylesheet">
<link href="{% static 'theme/css/style-responsive.css' %}" rel="stylesheet" />

<link href="{% static 'theme/js/select2/select2.css' %}" rel="stylesheet" /> {% endblock theme_styles %} {% block other_styles %}
<link rel="stylesheet" href="{% static 'case_list/css/style.css' %}">

<style>
    .form-row {
        margin-bottom: 10px;
    }

    .form-row:last-of-type {
        margin-bottom: 30px;
    }

    .popup-form-data .label {
        font-weight: bold;
        display: inline-block;
        vertical-align: middle;
        width: 45%;
        color: rgb(84, 84, 84);
        text-align: left;
    }

    .popup-form-data .value {
        display: inline-block;
        vertical-align: middle;
        width: 50%;
        color: rgb(84, 84, 84);
        text-align: left;
    }

    .investigator-name {
        cursor: pointer;
    }

    .rating span.star.filled:before,
    .rating span.star.filled~span.star:before {
        content: "\f005";
        color: #41CAC0;
    }

    .swal2-modal .swal2-input[type=number] {
        max-width: 100%;
    }

    .case-extras {
        text-align: left;
    }

    .case-extras h2 {
        font-size: 20px;
        font-weight: bold;
    }

    /* .adv-table {
        margin-top: -64px;
    }

    #paginator {
        background-color: gainsboro;
    }

    .current {
        margin-right: 7px;
    } */
    @media only screen and (max-width: 500px) {
    #cases-table{
        overflow-y:scroll;
    display:block;
        }
    }
    .mark {
    color: #d5d5d5;
    background: transparent;
}
.mark:hover {
    color: #FF9100;
    
}
.unmark {
    color: #FF9100;
    background: transparent;
}
.unmark:hover {
    color: #d5d5d5;
}
</style>
{% endblock other_styles %} {% load range_filter %} {% block content %}

<div class="row">
    <div class="col-sm-12">
        <section class="panel">
            <header class="panel-heading no-mouse-events">
                All Cases
                
            </header>
            <div class="panel-body">
                <!-- <div class="pagination">
                    <span class="step-links">
                                {% if cases.has_previous %}
                                   <button id="paginator" onclick="window.location.href='?page={{ cases.previous_page_number }}'"><i class="fa fa-chevron-left" style="color:black" aria-hidden="true"></i></button>
                                {% endif %}
                        
                                <span class="current">
                                     {{ cases.number }} of {{ cases.paginator.num_pages }}
                                </span> {% if cases.has_next %}
                    <button id="paginator" onclick="window.location.href='?page={{ cases.next_page_number }}'"><i class="fa fa-chevron-right" style="color:black" aria-hidden="true"></i></button>                    {% endif %}
                    </span>
                </div> -->
                <span style="float:right"><button class="btn btn-primary btn-sm generate-csv" href="#"data-value="csv"><i class="fa fa-share-square-o fa-lg" aria-hidden="true"></i></button></span>
                {% csrf_token %}
                <div class="adv-table editable-table">
                    <div class="clearfix">
                    </div>
                    <div class="space15"></div>
                    <table class="table table-striped table-hover table-bordered" id="cases-table">
                        <thead>
                            <tr>
                                    <th class="no-sort">Case No</th>
                                <th class="no-sort">Date</th>
                                <th class="no-sort">Case Name</th>
                                <th class="no-sort">Location</th>
                                <th class="no-sort" style="width:200px">Status</th>
                                <th class="no-sort">Broker
                                <th class="no-sort">Assigned Investigator</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            {% for case in cases %}
                            <tr>
                                <td>{{case.pk}}</td>
                                <td> {{ case.created_at}}</td>
                                <td><a href="/law-firm/case-details/{{ case.pk }}/">{{ case.name }}</a></td>
                                <td class="table-dropdown-holder">
                                    <span class="text">{{ case.client_address }}</span> {% if case.client_address.gmaps_link%}
                                    <span class="options"><a href="{{ case.client_address.gmaps_link | safe }}" target="_blank"><i class="fa fa-map-marker"></i></a></span>                                    {% else %}
                                    <span class="options">
                                        <i class="fa fa-map-marker"></i>
                                    </span> {% endif %}
                                </td>
                                <td class="table-dropdown-holder">
                                    <span class="text">
                                        {% if case.status == "Inactive" %}
                                        In progress
                                         {% else %}
                                        {{ case.status }}
                                    {% endif %}{% for status_update in status_updates %}{% if status_update.case == case %}{% if status_update.extra_info %}<i class="fa fa-info-circle extra-info-holder" style="margin-left:10px" data-stringified-info="{{status_update.extra_info}}"></i>{% endif %}{% endif %}{% endfor %}</span> {% if case.status != '' %}
                                    
                                    {% endif %}
                                    {% if case.status == "Closed" or case.status == "Signature obtained" or case.status == "Signature not obtained"  %}
                                        {% if case.is_document_received %}
                                            <button class="document-not-received" style="background:transparent;color:black;float: right;margin-right: -5px;margin-top:-23px;" case-id= "{{ case.pk }}"><i class="fa fa-file-text fa-2x unmark" style="font-size: 1.75em;"></i></button>
                                        {% else %}
                                            <button class="document-received" style="background:transparent;color:black;float: right;margin-right: -5px;margin-top:-30px" case-id= "{{ case.pk }}"><i class="fa fa-file-text fa-2x mark" style="font-size: 1.75em;"></i></button>
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td style="text-align: center;">
                                    {% if case.created_by %}
                                        <span style="cursor: pointer" class="created-by-name-table text" data-created-by-id="{{ case.created_by.pk }}">{{ case.created_by.user.first_name}} {{case.created_by.user.last_name}} </span>
                                    {% else %}
                                    <span style="cursor: pointer" class="created-by-name-table text" data-created-by-id="{{ case.created_by_master.pk }}">{{ case.created_by_master.user.first_name}} {{case.created_by_master.user.last_name}} </span>                                   
                                    {% endif %}
                                </td>
                                <td style="text-align: center;" class="table-dropdown-holder">

                                    {% if not case.investigator %}
                                    <div class="btn-group">
                                            <span style="cursor: pointer" class="no-investigator-name-table text"> No  Investigator Assigned</span>
                                    </div>
                                    {% else %}
                                    <span style="cursor: pointer" class="investigator-name-table text" data-investigator-id="{{ case.investigator.pk }}">{{ case.investigator.user.first_name }} {{ case.investigator.user.last_name }}</span>
                                    
                                    {% endif %}

                                </td>
                                
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
</div>

{% endblock content %} {% block theme_scripts %}
<script src="{% static 'theme/js/jquery-1.10.2.min.js' %}"></script>
<script src="{% static 'theme/js/jquery-migrate.js' %}"></script>

<script src="{% static 'theme/bs3/js/bootstrap.min.js' %}"></script>
<script class="include" type="text/javascript" src="{% static 'theme/js/jquery.dcjqaccordion.2.7.js' %}"></script>
<script src="{% static 'theme/js/jquery.scrollTo.min.js' %}"></script>
<script src="{% static 'theme/js/jQuery-slimScroll-1.3.0/jquery.slimscroll.js' %}"></script>
<script src="{% static 'theme/js/jquery.nicescroll.js' %}"></script>
<!--Easy Pie Chart-->
<script src="{% static 'theme/js/easypiechart/jquery.easypiechart.js' %}"></script>
<!--Sparkline Chart-->
<script src="{% static 'theme/js/sparkline/jquery.sparkline.js' %}"></script>
<!--jQuery Flot Chart-->
<script src="{% static 'theme/js/flot-chart/jquery.flot.js' %}"></script>
<script src="{% static 'theme/js/flot-chart/jquery.flot.tooltip.min.js' %}"></script>
<script src="{% static 'theme/js/flot-chart/jquery.flot.resize.js' %}"></script>
<script src="{% static 'theme/js/flot-chart/jquery.flot.pie.resize.js' %}"></script>

<script type="text/javascript" src="{% static 'theme/js/data-tables/jquery.dataTables.js' %}"></script>
<script type="text/javascript" src="{% static 'theme/js/data-tables/DT_bootstrap.js' %}"></script>

<script src="{% static 'theme/js/iCheck/jquery.icheck.js' %}"></script>

<!--common script init for all pages-->
<script src="{% static 'theme/js/scripts.js' %}"></script>

<!--script for this page only-->
<script src="{% static 'theme/js/table-editable.js' %}"></script>
<script src="{% static 'theme/js/table-editable1.js' %}"></script>
<script src="{% static 'theme/js/select2/select2.js' %}"></script>
<script src="{% static 'theme/js/jquery-tags-input/jquery.tagsinput.js' %}"></script>
<script>
    $(function () {
        EditableTable.init();
    });

</script>

<!-- END JAVASCRIPTS -->
{% endblock theme_scripts %} {% block other_scripts %}
<script src="{% static 'case_list/js/script.js' %}"></script>
<!-- <script src="{% static 'law_firm/js/details.js' %}"></script> -->
<script>
    var investigator_assigned = false, assign_investigator, show_investigator, case_id, additional_expenses, no_of_miles;
    $('a[data-nav-item=all-cases]').addClass('active');
    $('.select2-filter').select2({
        width: '90%'
    });
    // $('#navigation-button').text('');
    // $('#navigation-button').click(function () {
    //     location.assign('/law-firm/create-new-case/');
    // });
    $('#navigation-button').remove();

        $('.investigator-name').click(function () {
            show_investigator($(this).attr('data-investigator-id'), true);
        });
        

        $('.square-green input').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
            increaseArea: '20%' // optional
        });
        $('.select2-filter').select2({
            width: '90%'
        });
        EditableTable1.init();
    


    show_investigator = function (investigator_id, show_list) {
        'use strict';
        debugger;
        $.post('/law-firm/show-investigator-details/', {
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            investigator_id: investigator_id
        }, function (returned_data) {
            swal({
                title: 'Investigator details',
                customClass: 'popup-form-data',
                html: returned_data
            }).then(function () {
                
            });
        });

    };
    //Jquery pagination 




    // $('.assign-investigator').on('click', function () {
    //     case_id = $(this).attr('data-case-id');
    //     assign_investigator();
    // });

    $('.investigator-name-table').on('click', function () {
        show_investigator($(this).attr('data-investigator-id'), false);
    });
    

    $('.generate-csv').click(function(e){
        var case_id = $(this).attr('case-id');
        $('<form action="." method="POST"></form>')
            .append($('<input>', {
                'name': 'csrfmiddlewaretoken',
                'value': $('input[name=csrfmiddlewaretoken]').val(),
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'context',
                'value':  'generate-csv',
                'type': 'hidden'
            }))
            .appendTo('body').submit();

            setTimeout(function () {
             location.reload();
         }, 2000);
    })
    $('.extra-info-holder').click(function () {
    'use strict';

    var info_object = JSON.parse($(this).attr('data-stringified-info')), html_string = '', key;

    for (key in info_object) {
        if (info_object.hasOwnProperty(key)) {
            html_string += '<h4>' + key + '</h4>';
            html_string += '<p>' + info_object[key] + '</p>';
        }
    }

    swal({
        title: 'Status Details',
        html: html_string,
        customClass: 'details-popup'
    });
});
$('.document-received').click(function (event) {
            event.preventDefault()
            var case_id = $(this).attr('case-id');
            //debugger
            swal({
                title: 'Mark case as document received',
                text: 'Are you sure you want mark this case?',
                type: 'warning',
                confirmButtonText: 'Yes',
                showCancelButton: true,
                cancelButtonText: 'No'
            }).then(
                function () {
                $.post(location.pathname, {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    case_id: case_id,
                    context: 'document-received',
                    mark:'mark'
                }, function () {
                    swal({
                        title: 'Success!',
                        text: 'The document for this case is received',
                        type: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    })
                    setTimeout(function () {
                        location.reload();
                    }, 2000);
                }).fail(function (error) {
                
                swal({
                    title: 'Unable to mark',
                    text: 'Unable to mark case as document received',
                    type: 'error',
                    showConfirmButton: true

                });
            });
            }).catch(swal.noop);
});
$('.document-not-received').click(function (event) {
            event.preventDefault()
            var case_id = $(this).attr('case-id');
            //debugger
            swal({
                title: 'Unmark case as document received',
                text: 'Are you sure you want unmark this case?',
                type: 'warning',
                confirmButtonText: 'Yes',
                showCancelButton: true,
                cancelButtonText: 'No'
            }).then(
                function () {
                $.post(location.pathname, {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    case_id: case_id,
                    context: 'document-not-received',
                    mark:'unmark'
                }, function () {
                    swal({
                        title: 'Success!',
                        text: 'The document for this case is not received',
                        type: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    })
                    setTimeout(function () {
                        location.reload();
                    }, 2000);
                }).fail(function (error) {
                
                swal({
                    title: 'Unable to unmark',
                    text: 'Unable to unmark case as document sent',
                    type: 'error',
                    showConfirmButton: true

                });
            });
            }).catch(swal.noop);
});
</script>
{% endblock other_scripts %}