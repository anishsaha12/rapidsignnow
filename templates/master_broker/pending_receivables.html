{% extends 'master_broker/base.html' %} {% load staticfiles %} {% load range_filter %} {% block theme_styles %}

<link href="{% static 'theme/bs3/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'theme/css/bootstrap-reset.css' %}" rel="stylesheet">
<link href="{% static 'theme/font-awesome/css/font-awesome.css' %}" rel="stylesheet" />

<link href="{% static 'theme/js/iCheck/skins/minimal/minimal.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/red.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/green.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/blue.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/yellow.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/minimal/purple.css' %}" rel="stylesheet">

<link href="{% static 'theme/js/iCheck/skins/square/square.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/red.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/green.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/blue.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/yellow.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/square/purple.css' %}" rel="stylesheet">

<link href="{% static 'theme/js/iCheck/skins/flat/grey.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/red.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/green.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/blue.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/yellow.css' %}" rel="stylesheet">
<link href="{% static 'theme/js/iCheck/skins/flat/purple.css' %}" rel="stylesheet">

<link href="{% static 'theme/js/bootstrap-datepicker/css/datepicker.css' %}" rel="stylesheet" />
<link href="{% static 'theme/js/bootstrap-daterangepicker/daterangepicker-bs3.css' %}" rel="stylesheet" />
<link href="{% static 'theme/js/bootstrap-datetimepicker/css/datetimepicker.css' %}" rel="stylesheet" />

<link rel="stylesheet" href="{% static 'theme/js/data-tables/DT_bootstrap.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'theme/js/jquery-tags-input/jquery.tagsinput.css' %}" />

<!-- Custom styles for this template -->
<link href="{% static 'theme/css/style.css' %}" rel="stylesheet">
<link href="{% static 'theme/css/style-responsive.css' %}" rel="stylesheet" />

<link href="{% static 'theme/js/select2/select2.css' %}" rel="stylesheet" /> {% endblock theme_styles %} {% block other_styles %}
<link rel="stylesheet" href="{% static 'case_list/css/style.css' %}">

<style>
    .form-row {
        margin-bottom: 10px;
    }

    .form-row:last-of-type {
        margin-bottom: 30px;
    }

    .popup-form-data .label {
        font-weight: bold;
        display: inline-block;
        vertical-align: middle;
        width: 45%;
        color: rgb(84, 84, 84);
        text-align: left;
    }

    .popup-form-data .value {
        display: inline-block;
        vertical-align: middle;
        width: 50%;
        color: rgb(84, 84, 84);
        text-align: left;
    }

    .investigator-name {
        cursor: pointer;
    }

    .rating span.star.filled:before,
    .rating span.star.filled~span.star:before {
        content: "\f005";
        color: #41CAC0;
    }

    .swal2-modal .swal2-input[type=number] {
        max-width: 100%;
    }

    .case-extras {
        text-align: left;
    }

    .case-extras h2 {
        font-size: 20px;
        font-weight: bold;
    }

    .remove-filter {
        display: flex;
        align-items: center;
        justify-content: center;
        /* width: 50px;
        height: 50px;
        margin-left: 400px */
    }

    .apply-filter {
        /* width: 50px;
    height: 50px;
    margin-left: 500px; */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .law-firm-select {
        padding: 0;
    }

    .law-firm-select>.select2-choice {
        height: 100%;
    }

    .investigator-select {
        padding: 0;
    }

    .investigator-select>.select2-choice {
        height: 100%;
    }

    .broker-select {
        padding: 0;
    }

    .broker-select>.select2-choice {
        height: 100%;
    }

    .master-broker-select {
        padding: 0;
    }

    .master-broker-select>.select2-choice {
        height: 100%;
    }

    .status-select {
        padding: 0;
    }

    .status-select>.select2-choice {
        height: 100%;
    }
    .no-of-cases-select{
        padding: 0;
    }
    .no-of-cases-select > .select2-choice {
        height: 100%;
    }

    .input-large {
        position: relative;
    }

    .input-large label {
        position: absolute;
        top: 35px;
        right: 15px;
    }
    .page-load-status {
        display: none; /* hidden by default */
        padding-top: 20px;
        border-top: 1px solid #DDD;
        text-align: center;
        color: #777;
    }
    #search-bar{
        border-radius: 5px;
        width:300px;
    }
    #search-bar-container{
        margin-top: 14px;margin-left: -30px;
    }
    .clear{
    /* float: right; */
    margin-left: 65px;
    color: black;
    background: #dad4d4;
    width: 22px;
    height: 29px;
    margin-top: -44px;
}
.fa-times{
    align-items: center;
    justify-content: center;
    display: flex;
}

    /* .adv-table {
        margin-top: -64px;
    }

    #paginator {
        background-color: gainsboro;
    }

    .current {
        margin-right: 7px;
    } */
.mark {
    color: #d5d5d5;
    background: transparent;
}
.mark:hover {
    color: #FF9100;
    
}
.unmark {
    color: #FF9100;
    background: transparent;
}
.unmark:hover {
    color: #d5d5d5;
}
.paid{
    color: #2ba061;
    font-size: 22px;
    margin-top: 20px;
}
h2{
    font-size: 20px;
}
.bulk-buttons.hide {
        display: none;
    }
    #search-label{
    width :120px;float:left;
}
@media only screen and (max-width: 500px) {
    #search-bar{
        width:200px
    }
    #search-button{
        margin-left: 265px;
        margin-top: -78px;
    height: 29px;
    }
    .clear{
        margin-left: 306px;
        margin-top: -114px;
    }
    #search-label{
    width :50px;float:left;
    margin-left: 5px;
    }
    #cases-table{
    overflow-y:scroll;
   display:block;
    }
    #cases-table-1{
     
    overflow-y:scroll;
   display:block;
    }
    #navigation-button{
        margin-left: -10px;
    }
    .mark-as-paid{
        margin-top: 25px;
    }
    .mark-as-unpaid{
        margin-top: 25px;
    }
}
.dataTables_empty{
        text-align: center
    }
</style>
{% endblock other_styles %} {% load range_filter %} {% block content %}
{% load range_filter %}

<div id="filters-container">
    <div class="row">
        <div class="col-sm-12">
            <section class="panel">
                <header class="panel-heading no-mouse-events">
                    Filters
                    <span class="tools pull-right">
                                        <a href="javascript:;" class="fa fa-chevron-up"></a>
                                     </span>
                </header>
                <div class="panel-body" id="filters">
                    <form action="." method="" id="filter-form" class="form-horizontal bucket-form">
                        {% csrf_token %}
                        <br>
                        <div class="form-group">
                            <input type="hidden" name="filtering" value="on"/>
                            <div class="col-sm-3 control-label col-lg-3">Law Firm <sup>*</sup></div>
                            <div class="col-lg-6">
                                <select name="law-firm" id="law-firm-filter" class="form-control mbot-15 law-firm-select" data-placeholder="Please select a law firm">
                                            <option value=""></option>
                                            {% for law_firm in law_firms %}
                                            <option value="{{ law_firm.id }}">{{ law_firm.name }}</option>
                                            {% endfor %}
                                        </select>
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <div class="col-sm-3 control-label col-lg-3">Investigator<sup>*</sup></div>
                            <div class="col-lg-6">
                                <select name="investigator" class="form-control mbot-15 investigator-select" data-placeholder="Please select a investigator">
                                                <option value=""></option>
                                                {% for investigator in investigators %}
                                                <option value="{{ investigator.pk }}">{{ investigator.user.first_name }} {{ investigator.user.last_name }}</option>
                                                {% endfor %}
                                            </select>
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <div class="col-sm-3 control-label col-lg-3">Broker<sup>*</sup></div>
                            <div class="col-lg-6">
                                <select name="broker" class="form-control mbot-15 broker-select" data-placeholder="Please select a broker">
                                                    <option value=""></option>
                                                    {% for broker in brokers %}
                                                    <option value="{{ broker.pk }}">{{ broker.user.first_name }} {{ broker.user.last_name }}</option>
                                                    {% endfor %}
                                                    <!-- {% for master_broker in master_brokers %}
                                                    <option value="{{ master_broker.pk }}">{{ master_broker.user.first_name }} {{ master_broker.user.last_name }}</option>
                                                    {% endfor %} -->
                                                </select>
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <div class="col-sm-3 control-label col-lg-3">Master Broker<sup>*</sup></div>
                            <div class="col-lg-6">
                                <select name="master-broker" class="form-control mbot-15 master-broker-select" data-placeholder="Please select a master broker">
                                                        <option value=""></option>
                                                        {% for master_broker in master_brokers %}
                                                        <option value="{{ master_broker.pk }}">{{ master_broker.user.first_name }} {{ master_broker.user.last_name }}</option>
                                                        {% endfor %}
                                                    </select>
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <div class="col-sm-3 control-label col-lg-3">Status <sup>*</sup></div>
                            <div class="col-lg-6">
                                <select name="status" class="form-control mbot-15 status-select" data-placeholder="Please select a status">
                                        <option value=""></option>
                                        <option value="Signature obtained">Signature obtained</option>
                                        <option value="Signature not obtained">Signature not obtained</option>
                                                </select>
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <div class="col-sm-3 control-label col-lg-3">Date Range <sup>*</sup></div>
                            <div class="col-lg-6">
                                <div class="input-group input-large" data-date="mm/dd/yyyy" data-date-format="mm/dd/yyyy">
                                    <input type="text" class="form-control dpd1" name="from" id="from-date">
                                    <span class="input-group-addon" id="to">To</span>
                                    <input type="text" class="form-control dpd2" name="to" id="to-date">
                                </div>
                                <br>
                                
                            </div>
                        </div>
                        <br>
                        <div class="col-sm-12">
                            <div class="apply-filter">
                            <input type="hidden" name="context" value="apply-filters">
                            <button type="submit" class="btn btn-success apply-filter" form="filter-form">Apply Filters</button>
                            </div>
                        </div>
                    </form>
                    <br><br><br> {% if is_filter_applied %}
                    <div class="col-sm-12">
                        <div class="remove-filter">
                            <button type="submit" class="btn btn-danger">Remove Filters</button>
                        </div>
                    </div>
                    {% else %} {% endif %}
                </div>

            </section>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <section class="panel">
            <header class="panel-heading no-mouse-events">
                All Cases marked for payment

                <div style="float:right">
                        {% csrf_token %}
                        <input type="hidden" name="case-ids" value="">
                        <div class="buttons-holder bulk-buttons hide" style="margin-top: -6px;">
                            <button class="btn btn-primary btn-sm raise-combined-dispute" type="button" aria-expanded="false">Raise dispute for selected cases</button>
                            <button class="btn btn-primary btn-sm resolve-combined-dispute" type="button" aria-expanded="false">Resolve dispute for selected cases</button>
                        </div>
                    </div>
            </header>
            <div class="panel-body">
                <!-- <div class="pagination">
                    <span class="step-links">
                                {% if cases.has_previous %}
                                   <button id="paginator" onclick="window.location.href='?page={{ cases.previous_page_number }}'"><i class="fa fa-chevron-left" style="color:black" aria-hidden="true"></i></button>
                                {% endif %}
                        
                                <span class="current">
                                     {{ cases.number }} of {{ cases.paginator.num_pages }}
                                </span> {% if cases.has_next %}
                    <button id="paginator" onclick="window.location.href='?page={{ cases.next_page_number }}'"><i class="fa fa-chevron-right" style="color:black" aria-hidden="true"></i></button>                    {% endif %}
                    </span>
                </div> -->
                {% csrf_token %}
                <div class="adv-table editable-table">
                    <div class="clearfix">
                    </div>
                    <div class="space15"></div>
                <!-- <div class="col-lg-6" id="search-bar-container">
                    <form action="." method="" id="filter-form" class="form-horizontal bucket-form">
                            <input type="hidden" name="filtering" value="on"/>
                            <label class="control-label" id="search-label"> Search All: </label>
                            <div class="col-md-6"><div class="input-group"><input type="text" name="search" class="form-control medium" id="search-bar">
                            </div>
                        </div>
                        <button id ="search-button"><i class="fa fa-search" aria-hidden="true"></i></button>
                    </form>
                    <button class="btn btn-clear btn-sm clear" type="button"><i class="fa fa-times" aria-hidden="true"></i></button>
                </div> -->
                    <table class="table table-striped table-hover table-bordered" id="cases-table">
                        <thead>
                            <tr>
                                    <th class="no-sort">
                                        Mark
                                            <!-- <div class="square-green single-row" style="display: inline-block; width: 20px;">
                                                <input id="select-all-cases" type="checkbox">
                                            </div> -->
                                        </th>
                                <th class="no-sort">Case No.</th>
                                <th class="no-sort">Date</th>
                                <th class="no-sort">Name of Law Firm</th>
                                <th class="no-sort">Case Name</th>
                                <th class="no-sort" style="width: 200px;">Location</th>
                                <th class="no-sort" style="width: 200px;">Final Status</th>
                                <th class="no-sort">Broker
                                <th class="no-sort">Assigned Investigator</th>
                                <th class="no-sort">Total amount billed to Law Firm</th>
                                <th class="no-sort">Total amount to be paid to investigator</th>
                                <th class="no-sort">Raise Dispute</th>
                                <th class="no-sort">Resolve Dispute</th>

                            </tr>
                        </thead>
                        <tbody id="case-details">
                                
                            {% for case in cases %}
                            
                            <tr class="case-row" data-case-id="{{ case.pk }}">
                                <td>
                                    
                                    <div class="square-green single-row" style="display: inline-block; width: 20px;">
                                        <input id="{{ case.pk }}" class="case-select-to-mark-paid" type="checkbox" value="{{ case.pk }}">
                                    </div>
                                    
                                    
                                </td>
                                <td>{{case.pk}}</td>
                                <td> {{ case.created_at}}</td>
                                <td>{{ case.law_firm.name }}</td>
                                <td><a href="/master-broker/case-details/{{ case.pk }}/">{{ case.name }}</a></td>
                                <td class="table-dropdown-holder">
                                    <span class="text">{{ case.client_address }}</span> {% if case.client_address.gmaps_link%}
                                    <span class="options"><a href="{{ case.client_address.gmaps_link | safe }}" target="_blank"><i class="fa fa-map-marker"></i></a></span>                                    {% else %}
                                    <span class="options">
                                        <i class="fa fa-map-marker"></i>
                                    </span> {% endif %}
                                </td>
                                <td class="table-dropdown-holder">
                                    <span class="text">
                                        {% if case.is_signature_obtained == True %}<p> Signature obtained </p>
                                        {% else %} <p> Signature not obtained </p>
                                        {% endif %}
                                </td>
                                <td style="text-align: center;">
                                    {% if case.created_by %}
                                    <span style="cursor: pointer" class="created-by-name-table text" data-created-by-id="{{ case.created_by.pk }}">{{ case.created_by.user.first_name}} {{case.created_by.user.last_name}} </span>                                    {% else %}
                                    <span style="cursor: pointer" class="created-by-name-table text" data-created-by-id="{{ case.created_by_master.pk }}">{{ case.created_by_master.user.first_name}} {{case.created_by_master.user.last_name}} </span>                                    {% endif %}
                                </td>
                                <td style="text-align: center;" class="table-dropdown-holder">
                                    <span style="cursor: pointer" class="investigator-name-table text" data-investigator-id="{{ case.investigator.pk }}">{{ case.investigator.user.first_name }} {{ case.investigator.user.last_name }}</span>
                                </td>
                                <td style="font-size:14px"><b>${{case.amount_billed_to_law_firm }}</b></td>
                                <td style="font-size:14px"><b>${{case.amount_paid_to_investigator }}</b></td>
                                <td style="text-align: center;">
                                    {% if case.is_dispute_raised %}
                                    Dispute Raised
                                    <i class="fa fa-info-circle extra-info-holder" style="margin-left:10px" data-stringified-info="{{case.dispute_description}}"></i>
                                    {% else %}
                                    <button class="btn btn-primary raise-single-dispute"  data-case-id ="{{case.pk}}" style="background-color: cadetblue;font-size: 12px">Dispute</button>
                                    {% endif %}
                                </td>
                                <td style="text-align: center;">
                                    {% if case.is_dispute_raised %}
                                    <button class="btn btn-primary resolve-single-dispute"  data-case-id ="{{case.pk}}" style="background-color: cadetblue;font-size: 12px">Resolve</button>
                                    {% else %}
                                    No Dispute
                                    {% endif %}
                                </td>
                                
                            </tr>
                            
                            {% endfor %}
                            
                            
                        </tbody>

                    </table>
                </div>
                {% if cases.has_next %}
                <div class="scroller-status" style="display: flex;
                align-items: center;
                justify-content: center;">
                      
                        <div class="infinite-scroll-request loader-ellips" >
                          <span style="display: flex;
                          align-items: center;
                          justify-content: center;">
                          <img style="width:50px;height:50px;" src="https://media.giphy.com/media/3ohhwMWP97pn8aJ8ic/giphy.gif"></img>
                        </span>
                        </div>
                        <span style="display: flex;align-items: center;justify-content: center;">
                            <p class="infinite-scroll-error">No more to load</p>
                        </span>
                        
                </div>
                      
                      <!-- pagination has path -->
                      
                      <p class="pagination">
                        <a class="pagination__next" href="?page={{ cases.next_page_number }}&{{next_page_url}}">Next page</a>
                      </p>

                      {% else %}
                      <span style="display: flex;align-items: center;justify-content: center;">
                            <p class="infinite-scroll-last">End of content</p>
                        </span>
                      {% endif %}

                      
            </div>
        </section>
    </div>
</div>

{% endblock content %} {% block theme_scripts %}
<script src="{% static 'theme/js/jquery-1.10.2.min.js' %}"></script>
<script src="{% static 'theme/js/jquery-migrate.js' %}"></script>

<script src="{% static 'theme/bs3/js/bootstrap.min.js' %}"></script>
<script class="include" type="text/javascript" src="{% static 'theme/js/jquery.dcjqaccordion.2.7.js' %}"></script>
<script src="{% static 'theme/js/jquery.scrollTo.min.js' %}"></script>
<script src="{% static 'theme/js/jQuery-slimScroll-1.3.0/jquery.slimscroll.js' %}"></script>
<script src="{% static 'theme/js/jquery.nicescroll.js' %}"></script>
<!--Easy Pie Chart-->
<script src="{% static 'theme/js/easypiechart/jquery.easypiechart.js' %}"></script>
<!--Sparkline Chart-->
<script src="{% static 'theme/js/sparkline/jquery.sparkline.js' %}"></script>
<!--jQuery Flot Chart-->
<script src="{% static 'theme/js/flot-chart/jquery.flot.js' %}"></script>
<script src="{% static 'theme/js/flot-chart/jquery.flot.tooltip.min.js' %}"></script>
<script src="{% static 'theme/js/flot-chart/jquery.flot.resize.js' %}"></script>
<script src="{% static 'theme/js/flot-chart/jquery.flot.pie.resize.js' %}"></script>

<script type="text/javascript" src="{% static 'theme/js/data-tables/jquery.dataTables.js' %}"></script>
<script type="text/javascript" src="{% static 'theme/js/data-tables/DT_bootstrap.js' %}"></script>

<script src="{% static 'theme/js/bootstrap-datepicker/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'theme/js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js' %}"></script>
<script src="{% static 'theme/js/bootstrap-daterangepicker/moment.min.js' %}"></script>
<script src="{% static 'theme/js/bootstrap-daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'theme/js/bootstrap-timepicker/js/bootstrap-timepicker.js' %}"></script>
<script src="{% static 'theme/js/jquery.validate.min.js' %}"></script>

<script src="{% static 'theme/js/iCheck/jquery.icheck.js' %}"></script>

<!--common script init for all pages-->
<script src="{% static 'theme/js/scripts.js' %}"></script>

<!--script for this page only-->
<script src="{% static 'theme/js/table-editable.js' %}"></script>
<script src="{% static 'theme/js/table-editable1.js' %}"></script>
<script src="{% static 'theme/js/icheck-init.js' %}"></script>
<script src="{% static 'theme/js/select2/select2.js' %}"></script>
<script src="{% static 'theme/js/jquery-tags-input/jquery.tagsinput.js' %}"></script>
<script src="{% static 'theme/js/infinite-scroll.pkgd.js' %}"></script>


<script>
    $(function () {
        EditableTable.init();
    });
    
</script>

<!-- END JAVASCRIPTS -->
{% endblock theme_scripts %} {% block other_scripts %}
<script src="{% static 'case_list/js/script.js' %}"></script>
<script src="{% static 'master_broker/js/details.js' %}"></script>
<script>
    var investigator_assigned = false, assign_investigator, show_investigator, case_id, additional_expenses, no_of_miles;
    $('a[data-nav-item=pending-receivables]').addClass('active');
    $('.select2-filter').select2({
        width: '90%'
    });
    $('#navigation-button').text('Create New Case');
    $('#navigation-button').click(function () {
        location.assign('/master-broker/create-new-case/');
    });

    

        $('.investigator-name').click(function () {
            show_investigator($(this).attr('data-investigator-id'), true);
        });


        $('.square-green input').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
            increaseArea: '20%' // optional
        });
        $('.select2-filter').select2({
            width: '90%'
        });


    show_investigator = function (investigator_id, show_list) {
        'use strict';

        $.post('/master-broker/show-investigator-details/', {
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            investigator_id: investigator_id
        }, function (returned_data) {
            swal({
                title: 'Investigator details',
                customClass: 'popup-form-data',
                html: returned_data
            }).then(function () {
                if (show_list) {
                    assign_investigator();
                }
            });
        });

    };
    




    $('.assign-investigator').on('click', function () {
        case_id = $(this).attr('data-case-id');
        assign_investigator();
    });

    $('.investigator-name-table').on('click', function () {
        show_investigator($(this).attr('data-investigator-id'), false);
    });

$("#filters").css("display", "none")
    // debugger

    var nowDate = new Date();
    var today = new Date(nowDate.getFullYear(), nowDate.getMonth(), nowDate.getDate(), 0, 0, 0, 0);
    var endDate = $("#to-date").val();
    var startDate = $("#from-date").val();

    var fromDatePicker = $('#from-date');
    var toDatePicker = $('#to-date');

    fromDatePicker.datepicker({
        autoclose: true,
        endDate: today
    }).on('changeDate', function (e) {
        if(toDatePicker.val()!="" && toDatePicker.val()<fromDatePicker.val()){
            $('form').validate({
                rules: {
                    to: { 
                    greaterThan:"#from-date"
                    }
                }
            });
        }
});


    toDatePicker.datepicker({
        autoclose: true,
        endDate: today
    }).on('changeDate', function (e) {
        // // Revalidate the date field
        // fromDatePicker.formValidation('revalidateField', 'date');
        if(fromDatePicker.val()!="" && toDatePicker.val()<fromDatePicker.val()){
            $('form').validate({
                rules: {
                    to: { 
                    greaterThan:"#from-date"
                    }
                }
            });
        }
    });

    $.validator.addMethod("greaterThan", function(value, element, params) {
        if (!/Invalid|NaN/.test(new Date(value))) {
            return new Date(value) > new Date($(params).val());
        }

        return isNaN(value) && isNaN($(params).val()) 
            || (Number(value) > Number($(params).val())); 
            
    },'Must be greater than From Date.');

    




    $('.law-firm-select').select2({
        width: '100%'
    });
    $('.investigator-select').select2({
        width: '100%'
    });
    $('.status-select').select2({
        width: '100%'
    });
    $('.broker-select').select2({
        width: '100%'
    });
    $('.master-broker-select').select2({
        width: '100%'
    });
    $('.no-of-cases-select').select2({
        width: '100%'
    
    })




    $('input[type=text][name=from]').val('{{ from }}');
    $('input[type=text][name=to]').val('{{ to }}');
    //debugger
    {% if selected_firm %}
    
    $('#law-firm-filter').val('{{ selected_firm }}');
    $('#law-firm-filter').trigger('change');
    // $('.law-firm-select option[value="{{ selected_firm.id }}"]').attr("selected","selected");
    {% else %}
    $('.law-firm-select').val('');
    {% endif %}

    {% if selected_investigator %}
    $('.investigator-select').val('{{ selected_investigator }}');
    $('.investigator-select').trigger('change');
    {% else %}
    $('.investigator-select').val('');
    {% endif %}

    {% if selected_broker %}
    $('.broker-select').val('{{ selected_broker }}');
    $('.broker-select').trigger('change');
    {% else %}
    $('.broker-select').val('');
    {% endif %}

    {% if selected_master_broker %}
    $('.master-broker-select').val('{{ selected_master_broker }}');
    $('.master-broker-select').trigger('change');
    {% else %}
    $('.master-broker-select').val('');
    {% endif %}

    {% if selected_status %}
    $('.status-select').val('{{ selected_status }}');
    $('.status-select').trigger('change');
    {% else %}
    $('.status-select').val('');
    {% endif %}

    {% if search %}
    $('input[type=text][name=search]').val('{{ search }}');
    {% endif %}

    {% if is_marked_case %}
    $('input[type=checkbox][name=marked-case]').prop('checked',true)
    {% endif %}
    
    $('.no-of-cases-select').val('{{ no_of_cases }}');
    $('.no-of-cases-select').trigger('change');
    
    // $('.remove-filters').click, function(event){
    //     event.preventDefault()
    //     $('#law-firm-filter').val("").trigger('change');
    //     $('.investigator-select').val("").trigger('change');
    //     $('.status-select').val("").trigger('change');
    //     $('input[type=text][name=from]').val('');
    //     $('input[type=text][name=to]').val('');
    // }
    $('.remove-filter').click(function () {
        'use strict';

        $('<form action="." method="POST"></form>')
            .append($('<input>', {
                'name': 'csrfmiddlewaretoken',
                'value': $('input[name=csrfmiddlewaretoken]').val(),
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'context',
                'value': 'remove-filters',
                'type': 'hidden'
            }))
            .appendTo('body').submit();
    });

    $('.clear').click(function(){
        $('<form action="." method="POST"></form>')
        .append($('<input>', {
            'name': 'csrfmiddlewaretoken',
            'value': $('input[name=csrfmiddlewaretoken]').val(),
            'type': 'hidden'
        }))
        .append($('<input>', {
            'name': 'context',
            'value': 'clear-search',
            'type': 'hidden'
        }))
        .appendTo('body').submit();
    })
    // $('.apply-filter').click(function () {
    //     'use strict';

    //     $('<form action="." method="POST"></form>')
    //         .append($('<input>', {
    //             'name': 'csrfmiddlewaretoken',
    //             'value': $('input[name=csrfmiddlewaretoken]').val(),
    //             'type': 'hidden'
    //         }))
    //         .append($('<input>', {
    //             'name': 'context',
    //             'value': 'apply-filters',
    //             'type': 'hidden'
    //         }))
    //         .appendTo('body').submit();
    // });
    //debugger

    $('.extra-info-holder').click(function () {
    'use strict';

    var info_object = $(this).attr('data-stringified-info'), html_string = '', key;
    if (info_object == '')
        info_object = "No info"
    var field
        html_string += '<h4> Dispute Description </h4>';
        html_string += '<p>' + info_object + '</p>';

    swal({
        title: 'Dispute Details',
        html: html_string,
        customClass: 'details-popup'
    });
});


//     {% if cases.has_next %}
//    $('#case-details').infiniteScroll({
//   path: '.pagination__next',
//   append: '.case-row',
//   history: false,
//   scrollThreshold: 500000,
//   status: '.scroller-status',
//   hideNav: '.pagination',
//   loadOnScroll: true,
//   onInit: function(){

//     this.on( 'append', function() {$('.assign-investigator').on('click', function () {
//         case_id = $(this).attr('data-case-id');
//         assign_investigator();
//     });
//     $('.square-green input').iCheck({
//             checkboxClass: 'icheckbox_square-green',
//             radioClass: 'iradio_square-green',
//             increaseArea: '20%' // optional
//         });
//     $('.investigator-name-table').on('click', function () {
//         show_investigator($(this).attr('data-investigator-id'), false);
//     });
//     extraInfoHolder();
//     UpdateStatusAllCases();
//   })

//   },
// });
// {% endif %}


$('.mark-case').click(function (event) {
            event.preventDefault()
            var case_id = $(this).attr('case-id');
            //debugger
            swal({
                title: 'Mark Case as attention required',
                text: 'Are you sure you want mark this case?',
                type: 'warning',
                confirmButtonText: 'Yes',
                showCancelButton: true,
                cancelButtonText: 'No'
            }).then(
                function () {
                $.post('/master-broker/mark-case/', {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    case_id: case_id,
                    mark:'mark'
                }, function () {
                    swal({
                        title: 'Success!',
                        text: 'The Case is marked for attention',
                        type: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    })
                    setTimeout(function () {
                        location.reload();
                    }, 2000);
                }).fail(function (error) {
                
                swal({
                    title: 'Unable to mark',
                    text: 'Unable to mark case as case is already closed',
                    type: 'error',
                    showConfirmButton: true

                });
            });
            }).catch(swal.noop);
});
     $('.unmark-case').click(function (event) {
            event.preventDefault()
            var case_id = $(this).attr('case-id');
            //debugger
            swal({
                title: 'Unmark Case as attention required',
                text: 'Are you sure you want unmark this case?',
                type: 'warning',
                confirmButtonText: 'Yes',
                showCancelButton: true,
                cancelButtonText: 'No'
            }).then(
                function () {
                $.post('/master-broker/mark-case/', {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    case_id: case_id,
                    mark:'unmark'
                }, function () {
                    swal({
                        title: 'Success!',
                        text: 'The Case is unmarked for attention',
                        type: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    })
                    setTimeout(function () {
                        location.reload();
                    }, 2000);
                }).fail(function (error) {
                
                swal({
                    title: 'Unable to unmark',
                    text: 'Unable to unmark case as case is already closed',
                    type: 'error',
                    showConfirmButton: true
                });
            });
            }).catch(swal.noop);
     });
     {% if cases %}

     function reselect_bulk_cases() {
        var case_rows = $('.case-row'), outer_loop, selected_cases = [], selected_case;

        selected_cases = [];
     
        for (outer_loop = 0; outer_loop < case_rows.size(); outer_loop += 1) {
            selected_case = case_rows.eq(outer_loop);
            if (selected_case.find('.icheckbox_square-green').hasClass('checked')) {
                selected_cases.push(selected_case.attr('data-case-id'));
            }
        }

        $('input[name="case-ids"]').val(JSON.stringify(selected_cases));
        
        if (selected_cases.length === 0) {
            $('.bulk-buttons').addClass('hide');
        } else {
            $('.bulk-buttons').removeClass('hide');
        }
    }
     
    reselect_bulk_cases();
     
    setInterval(reselect_bulk_cases, 1000);
    
    {% endif %}
    setTimeout(function () {
         $('#select-all-cases + ins').click(function () {
             if ($(this).parent().hasClass('checked')) {
                 $('.case-row .icheckbox_square-green').addClass('checked');    
             } else {
                 $('.case-row .icheckbox_square-green').removeClass('checked');
             }
         });
     }, 3000);
    


$('.raise-single-dispute').click(function(e){
        var case_id = $(this).attr('data-case-id');
        swal({
            title: 'Raise dispute for the case',
            text: 'Are you sure?',
            html:'<br><div style="" class="form-horizontal"><div class="form-group"> <div class="col-md-9" style="margin-left:65px;"> <textarea style="height: 85px;" id="dispute-reason" name="dispute-reason" placeholder="Enter the dispute description" class="form-control"></textarea> </div></div></div>',
            confirmButtonText: 'Submit',
            preConfirm: function () {
                debugger
                return new Promise(function (resolve, reject) {
                    debugger
                var dispute_description = $('#dispute-reason').val();
                if (dispute_description != '')
                    resolve({
                        dispute_description

                    });
                })
                
            }
            
        }).then(function (dispute) {
        dispute_description = dispute['dispute_description']
        $('<form action="." method="POST"></form>')
            .append($('<input>', {
                'name': 'csrfmiddlewaretoken',
                'value': $('input[name=csrfmiddlewaretoken]').val(),
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'context',
                'value':  'raise-single-dispute',
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'case_id',
                'value':  case_id,
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'dispute-reason',
                'value':  dispute_description,
                'type': 'hidden'
            }))
            .appendTo('body').submit();

            setTimeout(function () {
             location.reload();
         }, 2000);
    }).catch(swal.noop);
})
$('.resolve-single-dispute').click(function(e){
        var case_id = $(this).attr('data-case-id');
        swal({
            title: 'Resolve dispute for the case',
            text: 'Are you sure?',
            type: 'question',
            confirmButtonText: 'Yes',
            showCancelButton: true,
            cancelButtonText: 'No'
        }).then(function () {
        $('<form action="." method="POST"></form>')
            .append($('<input>', {
                'name': 'csrfmiddlewaretoken',
                'value': $('input[name=csrfmiddlewaretoken]').val(),
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'context',
                'value':  'resolve-single-dispute',
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'case_id',
                'value':  case_id,
                'type': 'hidden'
            }))
            .appendTo('body').submit();

            setTimeout(function () {
             location.reload();
         }, 2000);
}).catch(swal.noop);
})
$('.raise-combined-dispute').click(function(e){
        var case_ids = $('input[name=case-ids]').val()
        swal({
            title: 'Raise dispute for selected cases',
            text: 'Are you sure?',
            html:'<br><div style="" class="form-horizontal"><div class="form-group"> <div class="col-md-9" style="margin-left:65px;"> <textarea style="height: 85px;" id="dispute-reason" name="dispute-reason" placeholder="Enter the dispute description" class="form-control"></textarea> </div></div></div>',
            confirmButtonText: 'Submit',
            preConfirm: function () {
                debugger
                return new Promise(function (resolve, reject) {
                    debugger
                var dispute_description = $('#dispute-reason').val();
                if (dispute_description != '')
                    resolve({
                        dispute_description

                    });
                })
                
            }
            
        }).then(function (dispute) {
        dispute_description = dispute['dispute_description']
        $('<form action="." method="POST"></form>')
            .append($('<input>', {
                'name': 'csrfmiddlewaretoken',
                'value': $('input[name=csrfmiddlewaretoken]').val(),
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'context',
                'value':  'raise-combined-dispute',
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'case_ids',
                'value':  case_ids,
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'dispute-reason',
                'value':  dispute_description,
                'type': 'hidden'
            }))
            .appendTo('body').submit();

            setTimeout(function () {
             location.reload();
         }, 2000);
}).catch(swal.noop);
})
$('.resolve-combined-dispute').click(function(e){
        var case_ids = $('input[name=case-ids]').val()
        swal({
            title: 'Resolve dispute for selected cases',
            text: 'Are you sure?',
            type: 'question',
            confirmButtonText: 'Yes',
            showCancelButton: true,
            cancelButtonText: 'No'
        }).then(function () {
        $('<form action="." method="POST"></form>')
            .append($('<input>', {
                'name': 'csrfmiddlewaretoken',
                'value': $('input[name=csrfmiddlewaretoken]').val(),
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'context',
                'value':  'resolved-combined-dispute',
                'type': 'hidden'
            }))
            .append($('<input>', {
                'name': 'case_ids',
                'value':  case_ids,
                'type': 'hidden'
            }))
            .appendTo('body').submit();

            setTimeout(function () {
             location.reload();
         }, 2000);
}).catch(swal.noop);
})
</script>
{% endblock other_scripts %}